pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- jeu d'aventure

function _init()
	create_player()
end

function _update()
	player_movement()
	update_camera()
end

function _draw()
	draw_map()
	draw_player()
	draw_ui()
end
-->8
-- map

function draw_map()
	map()
end

function check_flag(flag,x,y)
	local sprite=mget(x,y)
	return fget(sprite,flag)
end

--function update_camera()
--	camx=mid (0,p.x-7.5,31-15)
--	camy=mid (0,p.y-7.5,31-15)
--	camera(camx*8,camy*8)
--end

--autre methode
function update_camera()
	camx=flr(p.x/16)*16
	camy=flr(p.y/16)*16
	camera(camx*8,camy*8)
end

function next_tile(x,y)
	sprite=mget(x,y)
	mset(x,y,sprite+1)
end

function pick_up_key(x,y)
 next_tile(x,y)
 p.keys+=1
 sfx(0)
end

function open_door(x,y)
	next_tile(x,y)
	p.keys-=1
	sfx(1)
end
-->8
-- player

function create_player()
	p={
	 x=6,
	 y=4,
	 sprite=16,
	 keys=0
	}
end

function player_movement()
	newx=p.x
	newy=p.y
	if (btnp(➡️)) newx+=1
	if (btnp(⬅️)) newx-=1
	if (btnp(⬇️)) newy+=1
	if (btnp(⬆️)) newy-=1
	
	interact(newx,newy)
	
	if not check_flag(0,newx,newy) then
		p.x=mid(0,newx,127)
		p.y=mid(0,newy,63)
	end
end

function interact(x,y)
	if check_flag(1,x,y) then
		pick_up_key(x,y)
	elseif check_flag(2,x,y)
	and p.keys>0 then
		open_door(x,y)
	end
end

function draw_player()
	spr(p.sprite,p.x*8,p.y*8)
end
-->8
--ui

function draw_ui()
	camera()
	palt(0,false)
	palt(12,true)
	spr(32,2,2)
	palt()
	print_outline("X"..p.keys,10,2)
end

function print_outline(text,x,y)
	print(text,x-1,y,0)
	print(text,x+1,y,0)
	print(text,x,y-1,0)
	print(text,x,y+1,0)
	print(text,x,y,7)
end
__gfx__
00000000333333333333333333bbbb33111111114444444400000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003333333333a333333bbbbbb311111111cccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700333333333a9a33333bbbbbb3111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
000770003333333333a333333bbbbbb3111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
000770003333333333333a333bbbbbb3111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700333333333333a9a333bbbb33111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003333333333333a3333344333111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
0aaaaaa0333333333333333333444433111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000
0affffa000000000dddddddddddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
081ff18000000000dddddddddddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0af88fa000000000dddddadddddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000daaaadaddddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00dddd00000000004a444a4444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00dddd00000000004444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00d00d0000000000d222222dd222222d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000dddddddddddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cc0ccccc000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c0a0000c000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0aaaa0000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c0a000a00000000033333a3333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cc0ccc0c000000003aaaa3a333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccc000000003a333a3333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccc000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccc000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000001444444114420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000004405050444520000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000a4050504a5520000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000a4444444a5420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000004444441444420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000a4444474a4420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000a4244444a4200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000004224242442000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000101010000000000000000000000000200000000000000000000000000000002000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101120101013201010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101030303010101020101030101030101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101030301010201010101030303030101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101030103010101012201010303050501010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010505010102010105040401010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050404050505050504040101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104040404040404040401010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010102010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000500001c0501c0501c05000000290502a0502a05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00090000096501f650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
